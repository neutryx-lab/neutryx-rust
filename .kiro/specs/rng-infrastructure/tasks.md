# Implementation Plan

## Task Format Template

Major + Sub-task structure with parallel markers where applicable.

---

## Tasks

- [x] 1. RNGモジュールの基盤セットアップ
- [x] 1.1 依存関係とモジュール構造の構築
  - `pricer_kernel`のCargo.tomlに`rand`と`rand_distr`のworkspace依存を追加する
  - `lib.rs`にRNGモジュールの公開宣言を追加する
  - RNGサブモジュールの基本構造（公開API用、内部実装用、QMC用）を作成する
  - モジュールレベルドキュメントにBritish English規約と設計意図を記載する
  - _Requirements: 5.1, 5.2, 7.1, 7.4_

- [x] 2. 疑似乱数生成器(PRNG)ラッパーの実装
- [x] 2.1 シード管理付きPRNG構造体の作成
  - Monte Carlo用の再現可能な乱数生成器を実装する
  - シード値からの初期化機能を提供し、同一シードから同一シーケンスを保証する
  - 現在のシード値を取得するアクセサを実装する
  - Enzyme互換性のため、動的ディスパッチを避けた静的型設計とする
  - British Englishでrustdocコメントを記述する（"initialise", "behaviour"等）
  - _Requirements: 1.1, 1.2, 1.3, 7.1, 7.2, 8.1_

- [x] 2.2 (P) 一様分布生成メソッドの実装
  - [0, 1)範囲の単一f64値を生成するメソッドを実装する
  - 事前確保済みスライスへのバッチ生成メソッドを実装する（ゼロアロケーション）
  - 空バッファの場合は何もせず正常終了する仕様とする
  - 性能特性とバッファサイズ推奨値をドキュメントに記載する
  - _Requirements: 1.4, 1.5, 4.1, 4.2, 4.3, 4.4, 7.5_

- [x] 3. 正規分布生成機能の実装
- [x] 3.1 Ziggurat法による標準正規分布サンプリング
  - 平均0、標準偏差1の正規分布から単一値を生成するメソッドを実装する
  - Zigguratアルゴリズムによる高速サンプリングを活用する
  - 事前確保済みスライスへのバッチ生成メソッドを実装する（ゼロアロケーション）
  - Enzyme互換性のため固定サイズループを使用する
  - アルゴリズム選択の根拠と参考文献をドキュメントに記載する
  - _Requirements: 2.1, 2.2, 2.3, 2.6, 4.1, 4.3, 7.3, 8.2_

- [x] 3.2 (P) 大規模バッチ生成の性能検証
  - 100万サンプル以上の生成で性能劣化がないことを確認する
  - 1秒あたり100万サンプル以上の生成性能を達成する
  - 大規模バッチでのキャッシュ効率を考慮したバッファサイズ推奨値を検証する
  - _Requirements: 2.4, 4.5_

- [x] 4. 準モンテカルロ(QMC)プレースホルダーの実装
- [x] 4.1 (P) 低食い違いシーケンス抽象インターフェースの定義
  - 多次元低食い違いシーケンスのトレイトを定義する
  - 次元取得、次点生成、リセット、スキップ操作を含むAPIを設計する
  - 将来のSobol、Halton実装に備えたドキュメントを記載する
  - _Requirements: 3.1, 3.2_

- [x] 4.2 (P) Sobolシーケンススタブ実装の作成
  - Sobolシーケンスのプレースホルダー型を作成する
  - 全メソッドで明確なエラーメッセージ付きのパニックを発生させる
  - 将来の`sobol`クレート統合計画をドキュメントに記載する
  - PRNGとは別の名前空間で管理し、誤用を防止する
  - _Requirements: 3.3, 3.4_

- [x] 5. テストインフラストラクチャの構築
- [x] 5.1 シード再現性とバッファ動作のユニットテスト
  - 同一シードから同一シーケンスが生成されることを検証するテストを作成する
  - 空バッファ、単一要素、大規模バッファの各ケースをテストする
  - 一様分布値が[0, 1)範囲内であることを検証する
  - Sobolプレースホルダーのパニックを`should_panic`で確認する
  - _Requirements: 6.2, 6.4_

- [x] 5.2 (P) 統計的性質検証のプロパティテスト
  - proptestを使用した一様分布の範囲検証テストを実装する
  - 正規分布のモーメント検証（平均≈0、分散≈1）テストを実装する
  - 統計テスト失敗時の診断情報を含むアサーションを実装する
  - 複数のランダムシードでの検証を自動化する
  - _Requirements: 6.1, 6.3, 6.5_

- [x] 6. 統合と最終検証
- [x] 6.1 モジュール公開とAPI一貫性の確認
  - `pricer_kernel::rng`からの全公開APIインポートを検証する
  - `pricer_core`への依存がないことをビルド時に確認する
  - 他の`pricer_kernel`サブモジュールなしで単独テスト可能なことを確認する
  - _Requirements: 5.1, 5.3, 5.4_

- [x] 6.2 Enzyme互換性とドキュメント完成度の確認
  - 動的ディスパッチ(`Box<dyn Trait>`)が使用されていないことを確認する
  - 全公開関数・構造体・トレイトにrustdocが存在することを確認する
  - British English規約の遵守を最終チェックする
  - 将来のEnzyme統合における既知の制限事項をドキュメント化する
  - _Requirements: 7.2, 8.1, 8.3, 8.4_

---

## Requirements Coverage Matrix

| Requirement | Task(s) |
|-------------|---------|
| 1.1, 1.2, 1.3 | 2.1 |
| 1.4, 1.5 | 2.2 |
| 1.6 | 1.1, 2.1 |
| 2.1, 2.2, 2.3, 2.6 | 3.1 |
| 2.4, 2.5 | 3.2 |
| 3.1, 3.2 | 4.1 |
| 3.3, 3.4 | 4.2 |
| 4.1, 4.2, 4.3, 4.4 | 2.2, 3.1 |
| 4.5 | 3.2 |
| 5.1, 5.2, 5.3, 5.4 | 1.1, 6.1 |
| 6.1, 6.2, 6.3, 6.4, 6.5 | 5.1, 5.2 |
| 7.1, 7.2, 7.3, 7.4, 7.5 | 1.1, 2.1, 2.2, 3.1, 6.2 |
| 8.1, 8.2, 8.3, 8.4 | 2.1, 3.1, 6.2 |

**全8要件、全受け入れ基準がタスクにマッピング済み。**
